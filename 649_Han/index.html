<!--649 Final Project--><!--test line-->
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?1.29.1"></script>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/colorbrewer.v1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="index.css">
    <title>ScaryMommy Confession Board Data Visualization</title>

</head>
<body>
  <header>
  ScaryMommy Confession Board Data Visualization
  </header>

  <div id="topics"></div>
  <!-- <div id = "heatmap"></div>
  
    <div id="filter">
    	<div id = "likes">
		    <h3>Likes Filter</h3>
		    <input class="filter_likes" id="20" type="radio" name="likes">0-20 Likes</input><br>
		    <input class="filter_likes" id="50" type="radio" name="likes">20-50 Likes</input><br>
		    <input class="filter_likes" id="100" type="radio" name="likes">50-100 Likes</input><br>
		    <input class="filter_likes" id="200" type="radio" name="likes">100+ Likes</input><br>
		</div>

		<div id = "hugs">
			<h3>Hugs Filter</h3>
		    <input class="filter_hugs" id="20hugs" type="radio" name="hugs">0-20 Hugs</input><br>
		    <input class="filter_hugs" id="20hugs" type="radio" name="hugs">20-50 Hugs</input><br>
		    <input class="filter_hugs" id="100hugs" type="radio" name="hugs">50-100 Hugs</input><br>
		    <input class="filter_hugs" id="400hugs" type="radio"  name="hugs">100+ Hugs</input><br>
		</div>

		<div id = "metoos">
			<h3>Metoos Filter</h3>
		    <input class="filter_metoos" id="20metoos" type="radio" name="metoos">0-20 Me toos</input><br>
		    <input class="filter_metoos" id="50metoos" type="radio" name="metoos">20-50 Me toos</input><br>
		    <input class="filter_metoos" id="100metoos" type="radio"  name="metoos">50-100 Me toos</input><br>
		    <input class="filter_metoos" id="400metoos" type="radio" name="metoos">100+ Me toos</input><br>
		</div>
    </div> -->

    <!-- <div id = "scatterplot"><h2>Topics</h2> </div>  --> 
    
    <div id="keywords_rect"></div>
    <div id = "keywords"> </div>  
    <div id = "postboard"><h2>Post Board</h2></div>    

<script>
  //draw ten topic circles
  var Topic_frequency = [{"name":"love husband sex good years", "num":18663, "topic_num": 0},{name:"today didn told wanted made", "num":15115, "topic_num": 1},{name:"dh fucking fuck shit ass", "num":11457, "topic_num": 2},{name:"day time work home house", "num":18862, "topic_num": 3}, {name: "hate people friends family friend", "num": 21771, "topic_num": 4},{name: "eat fat food big dinner", "num": 26240, "topic_num": 5},{name: "kids mom kid im child", "num": 23141, "topic_num": 6},{name:"baby back year son school","num":23794, "topic_num": 7},{name: "dd ds night dh bed", "num":30837, "topic_num": 8},{name: "don feel bad make life", "num":31849, "topic_num": 9}];

  Topic_frequency.sort(function(a, b){ return (b.num - a.num); })


    var color = d3.scale.category10();
   var topicC = d3.select("#topics").append("svg")
      .attr("width", 1300)
      .attr("height", 200);

   var circles = topicC.selectAll("g")
      .data(Topic_frequency)
      .enter()
      .append("g")
      .append("circle")
      .attr("r", function(d,i){
          return (d.num/1000);
      })
      .attr("cx", function(d,i){ return (i*100+100);})
      .attr("cy", 50)
      .style("fill", function(d, i) { return color(i); })
      .on("mouseover", function(d, i){

            drawKeywords(d.topic_num);
      });
      // .append("svg:title")
      // .text(function(d) { return "Topic Frequency: " + d.num; });


    //draw topic title under topic circles
    d3.selectAll("g")
      .data(Topic_frequency)
      .append("text")
      .each(function(d){
        var word = d.name.split(" ");
        for( var j=0; j<word.length; j++){
          d3.select(this).append("tspan")
          .text(function(d,i){
            // console.log(word[j]);
            return word[j];
            })
          .attr("dy", j ? "1.2em" : 0)
          .attr("x", 0)
          .attr("text-anchor", "middle");
        }
      })
      .attr("transform", function(d,i){return "translate(" +(i*100+100)+", 100)"})
      .style("fill", function(d, i) { return color(i); });


      //add frequence number to circles
      d3.selectAll("g")
      .data(Topic_frequency)
      .append("text")
      .text(function(d,i){return d.num;})
      .attr("text-anchor", "middle")
      .attr("transform", function(d,i){return "translate(" +(i*100+100)+", 55)"})
      .style("fill", "#0f0f0f");

    //draw heatmap
    //height of each row in the heatmap
    //width of each column in the heatmap
    // var data = [
    // {score: 0.5, row: 0, col: 0},
    // {score: 0.7, row: 0, col: 1},
    // {score: 0.2, row: 1, col: 0},
    // {score: 0.4, row: 1, col: 1}
    // ];

    // var gridSize = 50,
    //   h = gridSize,
    //   w = gridSize,
    //   rectPadding = 60;

    // var colorLow = 'green', colorMed = 'yellow', colorHigh = 'red';

    // var margin = {top: 20, right: 80, bottom: 30, left: 50},
    //   width = 640 - margin.left - margin.right,
    //   height = 380 - margin.top - margin.bottom;

    // var colorScale = d3.scale.linear()
    //    .domain([-1, 0, 1])
    //    .range([colorLow, colorMed, colorHigh]);

    // d3.csv("data/topic0_keywordfrequency.csv")
    // .row(function(d) { return {  Keywords: d.Keywords, 
    //                              Frequency_all: +d.Frequency_all, 
    //                              text: d.Text,
    //                              URL:d.URL, 
    //                              Likes:+d.Likes,
    //                              Hugs:+d.Hugs,
    //                              MeToos:+d.Metoos,
    //                              sentiment: +d.sentiment,
    //                              sentiment_tag: d.sentiment_tag,
    //                              polarity: +d.polarity,
    //                              polarity_tag: +d.polarity_tag,
    //                              concept_text: d.concept_text,
    //                              concept_type: d.concept_type};
    // })
    // .get(function(error, rows) { 
    //   // console.log(rows); i<rows.length
    //   for(var i=0; i<10;i++){ //show 10 posts
    //         if(rows[i].Likes>=likes_filter){
    //           d3.select("#postboard")
    //              .append("p")
    //              .attr("class", "text")
    //              .attr("transform", "translate(100,"+i*20+")")
    //              .append("text")
    //              .style("font-weight", "bold")
    //              .style("text-anchor", "left")
    //              .text("Post Text: "+rows[i].text)
    //              .append("p")
    //              .text(" Likes: "+ rows[i].Likes +" Hugs: "+ rows[i].Hugs + " Me Toos: "+rows[i].MeToos); 
    //         }
    //    }
    // });

    // var svg = d3.select("#heatmap").append("svg")
    //   .attr("width", width + margin.left + margin.right)
    //   .attr("height", height + margin.top + margin.bottom)
    // .append("g")
    //   .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // var heatMap = svg.selectAll("#heatmap")
    //   .data(data, function(d) { return d.col + ':' + d.row; })
    // .enter().append("svg:rect")
    //   .attr("x", function(d) { return d.row * w; })
    //   .attr("y", function(d) { return d.col * h; })
    //   .attr("width", function(d) { return w; })
    //   .attr("height", function(d) { return h; })
    //   .style("fill", function(d) { return colorScale(d.score); });




// Add Filter
var likes_filter=0;
// post_board(likes_filter);
// drawTopics();
post_board(likes_filter);

d3.selectAll(".filter_likes").on("change", function() {
  
  var type = this.value;
    if(this.class="filter_likes"){
          if(this.checked){
            likes_filter=this.id;
          }
          else {likes_filter=0;}
          console.log(likes_filter);
          drawTopics();
          post_board(likes_filter);
    }
  // drawKeywords(datanum);
 });
//Add Text
function post_board(likes_filter){
    d3.selectAll(".text").remove();
    d3.csv("data/newdata_with_sentiment.csv")
    .row(function(d) { return {  ID: d.ID, 
                                 PostID: d.PostID, 
                                 text: d.Text,
                                 URL:d.URL, 
                                 Likes:+d.Likes,
                                 Hugs:+d.Hugs,
                                 MeToos:+d.Metoos,
                                 sentiment: +d.sentiment,
                                 sentiment_tag: d.sentiment_tag,
                                 polarity: +d.polarity,
                                 polarity_tag: +d.polarity_tag,
                                 concept_text: d.concept_text,
                                 concept_type: d.concept_type};
    })
    .get(function(error, rows) { 
      // console.log(rows); i<rows.length
      for(var i=0; i<10;i++){ //show 10 posts
            if(rows[i].Likes>=likes_filter){
              d3.select("#postboard")
                 .append("p")
                 .attr("class", "text")
                 .attr("transform", "translate(100,"+i*20+")")
                 .append("text")
                 .style("font-weight", "bold")
                 .style("text-anchor", "left")
                 .text("Post Text: "+rows[i].text)
                 .append("p")
                 .text(" Likes: "+ rows[i].Likes +" Hugs: "+ rows[i].Hugs + " Me Toos: "+rows[i].MeToos); 
            }
       }
    });
}   


//draw xy axis
var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 500 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var x = d3.scale.linear()
    .range([0, width]);

var y = d3.scale.linear()
    .range([height, 0]);

var r = d3.scale.linear()
    .range([2,20]);

var color = d3.scale.category10();

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var svg = d3.select("#scatterplot").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .attr("class", "sp")
  	.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.csv("data/sentimentallistoutput1202.csv", function(error, data) {
  data.forEach(function(d) {
    d.sentiment = +d.sentiment;
    d.polarity = +d.polarity;
  });

  y.domain(d3.extent(data, function(d) { return d.sentiment; })).nice();
  x.domain(d3.extent(data, function(d) { return d.polarity; })).nice();

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height/2 + ")")
      .call(xAxis)
    .append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text("polarity");

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("sentiment");

	// svg.selectAll(".dot")
	//   .data(data)
	// .enter().append("circle")
	//   .attr("class", "dot")
	//   .attr("r", 3.5)
	//   .attr("cx", function(d) { return x(d.polarity); })
	//   .attr("cy", function(d) { return y(d.sentiment); })
	//   .style("fill", function(d) { return color(d.species); });

});

function drawTopics(){
  for (var i = 0; i < 10; i++) {
      drawTopics_num(i);
  };
}

function drawTopics_radius(data_num){
var data_length=0;
d3.csv("data/all_topic"+data_num+".csv")
      .row(function(d) { return {  ID: d.ID, 
                                   PostID: d.PostID, 
                                   text: d.Text,
                                   URL:d.URL, 
                                   Likes:+d.Likes,
                                   Hugs:+d.Hugs,
                                   MeToos:+d.Metoos,
                                   sentiment: +d.sentiment,
                                   sentiment_tag: d.sentiment_tag,
                                   polarity: +d.polarity,
                                   polarity_tag: +d.polarity_tag,
                                   TopicNum: d.TopicNum, //changed to TopicNum in the new data file
                                   TopicText: d.TopicText}; //changed to TopicText in the new data file
      })
      .get(function(error, rows) { 
          data_length=rows.length;
      });
return data_length;
}

function drawTopics_num(data_num){
	d3.selectAll(".dot").remove();
	d3.selectAll(".txt").remove();
	var data_length;
  d3.csv("data/all_topic"+data_num+".csv")
  		.row(function(d) { return {  ID: d.ID, 
  		                             PostID: d.PostID, 
  		                             text: d.Text,
  		                             URL:d.URL, 
  		                             Likes:+d.Likes,
  		                             Hugs:+d.Hugs,
  		                             MeToos:+d.Metoos,
  		                             sentiment: +d.sentiment,
  		                             sentiment_tag: d.sentiment_tag,
  		                             polarity: +d.polarity,
  		                             polarity_tag: +d.polarity_tag,
  		                             TopicNum: d.TopicNum, //changed to TopicNum in the new data file
                                   TopicText: d.TopicText}; //changed to TopicText in the new data file
  		})
	    .get(function(error, rows) { 
	      // console.log(rows);
	      //draw xy axis
	      y.domain(d3.extent(rows, function(d) { return d.sentiment; })).nice();
  			x.domain(d3.extent(rows, function(d) { return d.polarity; })).nice();
  			var color = d3.scale.category10();
  			var margin = {top: 20, right: 20, bottom: 30, left: 40};
        var senti_values = [];
        var polar_values = [];
        //var mean = d3.mean()
        // var mean = d3.mean();
        /*Draw topics based on like filter*/
        var senti_count=0;
        var polar_count=0;
        var data_length=rows.length;
      	     for(var i=0; i<rows.length;i++){

                if(rows[i].sentiment >=-1 && rows[i].sentiment <=1){
                   senti_values[senti_count] = rows[i].sentiment;
                   senti_count++;
                }
                if(rows[i].polarity >=0 && rows[i].polarity <=1){
                   polar_values[polar_count] = rows[i].polarity;
                   polar_count++;
                }
  	        }
            var senti_median = d3.median(senti_values);
            var polar_median = d3.median(polar_values);
            console.log("polarity"+data_num+": "+polar_median);
            console.log("sentiment"+data_num+": "+senti_median);
           //     if(rows[i].Likes>=likes_filter){
                d3.select(".sp")
                .append("g")
                .append("circle")
                .attr("class", "dot")
                .attr("r",5)
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                .attr("cx", x(polar_median))
                .attr("cy", y(senti_median))
                // .on("click", click)
                .style("fill", "#cfecf3");

                d3.select(".sp")
                .append("text")
                .attr("class", "txt")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                .attr("x", x(polar_median))
                .attr("y", y(senti_median))
                .text(data_num);
	    });
}

// drawKeywords();
var WordsText = '';
var allText;
//console.log(WordsText);
var rect= d3.select("#keywords_rect").append("svg:svg").attr("height", 250).attr("width", 1000);
function drawKeywords(data_num){
      d3.selectAll(".keywordtext").remove();
      d3.selectAll(".keywordall").remove();
      d3.selectAll(".keywordtopic").remove();
      // This is the overall data frequency
      /*
      d3.csv("data/new_all_keywordsfrequency.csv")
      .row(function(d) { 
        return {  Keywords: d.Keywords, 
                  Frequency: +d.Frequency};
      })
      .get(function(error, row_keywords) { 
        //console.log(row_keywords[1].Keywords);
         for(var i=0; i<30;i++){
             d3.select("#keywords")
               .append("p")
               .attr("class", "text")
               .attr("transform", "translate(100,"+i*20+")")
               .attr("width", "180px")
               .append("text")
               .style("font-weight", "bold")
               .style("text-anchor", "left")
               .text(row_keywords[i].Keywords)
               ;
             
            rect.append("svg:rect")       // attach a rectangle
              .attr("x", 0)         // position the left of the rectangle
              .attr("y", 16*i+50) 
              .attr("fill","#666")         // position the top of the rectangle
              .attr("height", 10)    // set the height
              .attr("width", row_keywords[i].Frequency/100)    // set the width
              ;
               
        }
        //console.log(row_keywords)
        allText=row_keywords
        //console.log(allText.indexOf('dh'));
        //console.log(allText)
      });
      */

      //var rotate = d3.svg.transform().rotate(-90);

      d3.csv("data/topic"+data_num+"_keywordfrequency.csv")
      .row(function(d) { 
        return {  Keywords: d.Keywords, 
                  Frequency_all: +d.Frequency_all,
                  Keyword: d.Keyword, 
                  Frequency_topic: +d.Frequency_topic
                  };
      })
      
      .get(function(error, row_keywords0) {
         for(var i=0; i<30;i++){
             d3.select("#keywords").append("g").append("text")
               //.attr('transform', "rotate(-45)")
               .attr("class", "keywordtext")
              // .attr("x", (30*i+50))         // position the left of the rectangle
              // .attr("y", 100) 
               .attr("transform", "translate("+(40*i+60)+", 0)")
               .style("text-anchor", "top")
               .text(row_keywords0[i].Keyword)
               ;

              rect.append("svg:rect")       // attach a rectangle
              .attr("class", "keywordall")
              .attr("x", 0)         // position the left of the rectangle
              .attr("y", 30*i+50) 
              .attr("fill","#666")         // position the top of the rectangle
              .attr("height", 20)    // set the height
              .attr("width", row_keywords0[i].Frequency_all/100)    // set the width
              .attr('transform', "rotate(-90)")
              
              ;

             rect.append("svg1:rect")       // attach a rectangle
                  .attr("class", "keywordtopic")
                  .attr("x", 0)         // position the left of the rectangle
                  .attr("y", 30*i+50) 
                  .attr("fill","orange")         // position the top of the rectangle
                  .attr("height", 20)    // set the height
                  .attr("width", row_keywords0[i].Frequency_topic/100)    // set the width
                  .attr('transform', "rotate(-90)")
                  
                  ;              
        }
           
      });
}

</script>


</body>
</html>